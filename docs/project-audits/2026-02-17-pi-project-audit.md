<!-- AGENT NOTE: This is a point-in-time snapshot from 2026-02-17. It may be
     useful for quick orientation, but DO NOT rely on it as the source of truth.
     Cross-check against the canonical progress files (phase-N-progress.md),
     canopy-spec.md, and actual source code — especially for implementation
     status, known bugs, and phase completion. -->

# Canopy Reader — Project Audit — 2026-02-17 (pi)
Generated by Pi coding agent on Tuesday, February 17, 2026.

**Date**: 2026-02-17
**Scope**: Full project audit — purpose, architecture, progress, risks, and source inventory.

---

## 1. Project Understanding

### 1.1 Purpose, Architecture, Major Features

**Canopy** is a **self-hosted read-it-later and knowledge management app** (a Readwise Reader alternative) for a single user deployed at `canopy.annjose.com`.

**Architecture:**
- **Monorepo** (pnpm workspaces + Turborepo) with two active packages: `@canopy/web` (Next.js 15 App Router) and `@canopy/shared` (types/constants)
- **Backend**: Next.js API routes running on **Cloudflare Workers** via `opennextjs-cloudflare`
- **Database**: Cloudflare **D1** (SQLite) with 3 migration files
- **Storage**: Cloudflare **R2** for article HTML, files, thumbnails
- **Auth**: Cloudflare Access (Zero Trust, single user)
- **Client state**: SWR for data fetching
- **UI**: Tailwind CSS v4 + shadcn/ui primitives + Radix + Lucide icons

**Major features implemented:**
- Save articles by URL with content extraction (Mozilla Readability + linkedom)
- Three-panel layout (sidebar / document list / right panel) à la Readwise Reader
- Document lifecycle: Inbox → Reading → Later → Archive, plus favorites + soft-delete trash
- Clean reader view with ToC, font size, progress tracking, prev/next navigation
- **Tags**: create/rename/merge/delete, per-document tagging, filter by tag
- **Highlights**: text selection in reader → colored highlights, inline rendering, notes on highlights
- **Document notes**: one freeform note per document
- **Notebook panel**: unified view of tags + note + highlights with markdown export
- **RSS feeds**: subscribe, auto-discover, poll, OPML import, folder grouping, mark-all-read
- Vim-style keyboard shortcuts throughout + help modal
- Command palette search
- Dark mode
- Mobile responsive layout

### 1.2 Current Implementation Progress

| Phase | Description                     | Status         |
|-------|---------------------------------|----------------|
| **1** | Foundation & Core Reading (MVP) | ✅ **Complete** |
| **2** | Tags, Notes & Highlights        | ✅ **Complete** |
| **3** | RSS Feeds                       | ✅ **Complete** |
| **4** | File Uploads (PDF)              | ❌ Not started  |
| **5** | Newsletter / Email Integration  | ❌ Not started  |
| **6** | Browser Extension               | ❌ Not started  |
| **7** | Obsidian Integration            | ❌ Not started  |
| **8** | Polish & Advanced Features      | ❌ Not started  |

The project is **3 of 8 phases complete** — the core reading + annotation + RSS experience is fully built and deployed. The `apps/extension` and `apps/email-worker` directories mentioned in repo-structure.md do **not yet exist** on disk (they're planned for Phases 5–6).

### 1.3 Interesting Findings, Risks, Inconsistencies & Notes

1. **Spec inconsistency**: `canopy-spec.md` mentions the Cloudflare adapter as `@cloudflare/next-on-pages` or `opennextjs-cloudflare`, but the project rules and actual implementation use `opennextjs-cloudflare` exclusively. The spec hasn't been updated to remove the old reference.

2. **No tests**: The repo has zero test files. The repo-structure doc says "testing will be added in a dedicated pass" but this hasn't happened after 3 phases. As features accumulate, retroactive test coverage becomes harder.

3. **No automated cron for RSS**: Feed polling is API-route-based only (`POST /api/feeds/poll`). The cron trigger in `wrangler.toml` is commented out. Feeds must be polled manually or via an external trigger — there's no automatic background polling yet.

4. **Known bugs tracked in `phase-last-defer.md`**: The Save button doesn't work in reader view, and there's a wishlist item for default images when no OG image exists.

5. **Local D1 data exists**: The `.wrangler/state/` directory has a SQLite database and ~24 R2 blobs, indicating active local development/testing with real content.

6. **Tag slug vs. name duality**: Tags store both a display `name` (freeform) and a `slug` (kebab-case for URLs). This is a thoughtful decision but adds complexity — the spec originally said tags are just kebab-case `name`, so this evolved during implementation.

7. **One note per document**: A conscious design decision (enforced by unique index) — simpler than the spec's original mention of multiple document notes.

8. **No Phase 3 progress file**: Unlike Phases 1 and 2 which have separate plan + progress files, Phase 3 combines both into a single `phase-3-rss-feeds.md`. Minor process inconsistency but all milestones are marked Done.

9. **Build artifacts checked in?**: The `.open-next/` and `.next/` directories appear in the file listing. If these aren't gitignored, that's a lot of unnecessary build output in the repo. (Though they may be gitignored — I didn't verify.)

### 1.4 Assumptions Made

- Assumed the `.next/` and `.open-next/` directories are gitignored (they're build artifacts); did not verify by reading `.gitignore`.
- Assumed `pnpm build` and `pnpm typecheck` currently pass, based on the progress docs saying Phase 3 is complete with a production build verified.
- Did not read individual source files (components, API routes, lib modules) — assessment of feature completeness is based solely on the progress tracking docs, file listing, and spec. The actual implementation quality/correctness is unverified.
- Treated `AGENTS.md` as the authoritative project rules document.

---

## 2. Files Read

### Context-provided
- `AGENTS.md` — project context / rules (injected as system instructions)

### Explicitly read
1. `docs/canopy-spec.md` — full product specification
2. `docs/repo-structure.md` — monorepo layout and conventions
3. `docs/plans/phase-1-progress.md` — Phase 1 implementation status
4. `docs/plans/phase-2-progress.md` — Phase 2 implementation status
5. `docs/plans/phase-3-rss-feeds.md` — Phase 3 plan + progress (combined)
6. `docs/plans/phase-last-defer.md` — deferred items / known bugs
7. `docs/decisions.md` — design decisions log
8. `packages/shared/src/types.ts` — shared TypeScript types
9. `apps/web/wrangler.toml` (partial) — Cloudflare bindings config
10. `apps/web/package.json` (partial) — dependencies and scripts

Also ran `find` commands to get the full file tree.

### Did NOT read
- **All source code** in `apps/web/src/` (~50+ files): components, hooks, lib modules, API routes, pages, CSS
- `docs/plans/phase-1-foundation.md`, `docs/plans/phase-2-tags-highlight.md` (detailed plans)
- `docs/schema.sql` (full SQL reference)
- `migrations/*.sql` (individual migration files)
- `scripts/migrate.sh`
- Config files: `turbo.json`, root `package.json`, root `tsconfig.json`, `pnpm-workspace.yaml`, `apps/web/tsconfig.json`, `apps/web/next.config.ts`, `apps/web/tailwind.config.ts`, `apps/web/open-next.config.ts`, `apps/web/postcss.config.mjs`, `apps/web/env.d.ts`, `apps/web/components.json`
- `packages/shared/src/constants.ts`, `packages/shared/src/index.ts`
- `README.md`, `.claude/settings.local.json`
- All build output in `.next/`, `.open-next/`, `.turbo/`, `.wrangler/`
